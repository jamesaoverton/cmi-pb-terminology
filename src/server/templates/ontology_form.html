{% extends "template.html" %}
{% block content %}

<div class="row">
    <p>View in: <a href="/{{ table_name }}/{{ term_id }}?view=tree">tree</a> | <a href="/{{ table_name }}/{{ term_id }}">table</a></p>
</div>

<div class="row" style="padding-bottom:5px; padding-top:20px;">
    <form method="post">
        <div class="row">
            <div class="col-md-4">
                <h3 style="padding-bottom:20px;">Term Metadata</h3>
            </div>
            <div class="col-md-8">
                <div class="row float-end">
                    <div class="col-md-8">
                        <select class="form-select" id="metadata-select">
                            <option selected>Add new annotation</option>
                            {% for term_id, label in annotation_properties.items() %}
                            <option value="{{ term_id }}">{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <a class="btn btn-outline-primary" href="javascript:addField('annotation')">Add</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" id="term-metadata">
            {{ metadata|safe }}
        </div>
        <div class="row">
            <div class="col-md-4">
                <h3 style="padding-bottom:20px;">Logical Definition</h3>
            </div>
            <div class="col-md-8">
                <div class="row float-end">
                    <div class="col-md-8">
                        <select class="form-select" id="logic-select">
                            <option selected>Add logic</option>
                            {% if entity_type == "owl:Class" %}
                            <option value="rdfs:subClassOf">parent class</option>
                            <option value="owl:equivalentClass">equivalent class</option>
                            <option value="owl:disjointWith">disjoint with</option>
                            {% elif entity_type == "owl:ObjectProperty" or entity_type == "owl:DatatypeProperty" %}
                            <option value="rdfs:subPropertyOf">parent property</option>
                            <option value="owl:equivalentProperty">equivalent property</option>
                            <option value="owl:disjointWith">disjoint with</option>
                            <option value="owl:inverseOf">inverse property</option>
                            <option value="rdfs:domain">domain</option>
                            <option value="rdfs:range">range</option>
                            {% elif entity_type == "owl:Individual" %}
                            <option value="rdf:type">type of</option>
                            <option value="owl:sameAs">same individual</option>
                            <option value="owl:differentFrom">different individual</option>
                            {% endif %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <a class="btn btn-outline-primary" href="javascript:addField('logic')">Add</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="row" id="term-logic">
            {{ logic|safe }}
        </div>
        <button type="submit" class="btn btn-large btn-outline-primary">Submit</button>
    </form>
</div>

<script>
    function addField(fieldType) {
        // Get the selected predicate label & ID
        var select;
        if (fieldType === 'annotation') {
            select = document.getElementById("metadata-select");
        } else {
            select = document.getElementById("logic-select");
        }
        var predicateId = select.options[select.selectedIndex].value;
        var predicate = select.options[select.selectedIndex].text;

        // Find the last row ID
        var rowId = 0;
        while(true) {
            if (document.getElementById(rowId.toString()) === null) {
                break;
            }
            rowId += 1;
        }
        console.log(rowId);

        // Create a new input row for the form
        var inptRow = document.createElement("div");
        inptRow.setAttribute("class", "row mb-3");
        inptRow.setAttribute("id", rowId);
        var innerHTML = `<div class="col-auto"><a class="btn btn-sm btn-danger" href="javascript:del('${rowId}')">x</a></div>`
        innerHTML += `<label class="col-sm-2 col-form-label">${predicate}</label>`
        innerHTML += '<div class="col-sm-9">'
        if (fieldType == 'annotation') {
        innerHTML += `<input type="text" class="form-control" name="${predicateId}">`
        } else {
            innerHTML += `<input type="text" class="typeahead form-control" id="{{ table_name }}-typeahead-form" name="${predicateId}">`
        }
        innerHTML += '</div></div>'
        inptRow.innerHTML = innerHTML;

        // Add the input row to the form
        var ele;
        if (fieldType == 'annotation') {
            ele = document.getElementById("term-metadata");
        } else {
            ele = document.getElementById("term-logic");
        }
        ele.appendChild(inptRow);
        if (fieldType == 'logic') {
            $('.typeahead').each(function() { configure_typeahead_form(this); });
        }
    }

    function del(rowId) {
        var ele = document.getElementById(rowId);
        ele.remove();
    }
</script>


{% endblock %}